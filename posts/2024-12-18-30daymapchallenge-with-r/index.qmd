---
title: "Rによる30DayMapChallenge"
description: |
  Rでチャレンジした30DayMapChallengeを振り返りました。
author: "Keisuke ANDO"
date: 2024-12-18
categories: [geo, rpackage]
image: images/map.jpg
---

## 1. はじめに

先月、30DayMapChallengeをほぼRで完走しました。30DayMapChallengeは11月の間に毎日決められたテーマに沿って地図を作成するソーシャルイベントです。この記事では、この活動を振り返ります。

研究で地図づくりをしていますが、研究対象である交通事故以外の地図を作ることはないため、新鮮でした。ここで新しく知ったRパッケージやデータも多かったです。ここでは、30DayMapChallengeの経緯や感想、実際に使ったパッケージや作成した地図を紹介します。

## 2. 私の30DayMapChallenge

[30DayMapChallenge](https://30daymapchallenge.com/)は毎年11月におこなわれている地図を作成するソーシャルイベントです。参加者は毎日あらかじめ決められたテーマにしたがい地図を作成します。作成した地図は`#30DayMapChallenge`というハッシュタグとともにSNSに投稿します。このような1か月間のチャレンジはほかにもあり、毎日決められたテーマの絵を描く[Inktober Challenge](https://inktober.com/)や[30DayChartChallenge](https://github.com/30DayChartChallenge/Edition2024)があります。

![30DayMapChallenge 2024で示された30のテーマ](images/30daymapchallenge.png)

私が今年30DayMapChallengeに挑戦した理由は、いま思うとはっきりしていません。なんとなくはじめたという感じです。30DayMapChallengeについては、過去にXでみたことがあり、知ってはいました。ただ、クォリティの高い地図が投稿されており、「時間がかかりそう」「むずかしそう」という印象をもっていたため、これまで挑戦はしていませんでした。今年は昨年に続いて、地図系のコミュニティイベントである[FOSS4G TOKAI 2024](https://foss4gtokai.my.canva.site/2024)に参加したのですが、そこで30DayMapChallengeに挑戦したひとの話を聞いた印象が残っていたというのもあると思います。11月1日になって、Xで流れてくる地図をみて、金曜日で時間があったこともあり、ふと気が付いたら、スタートを切っていたという状態でした。1日チャレンジしたら、あとは途中で終わらせたくないので、空いた時間にコツコツ地図をつくりました。

実際に挑戦してみた感想としては、結構大変でした。時間がかかります。地図づくりをはじめると、こだわりが出てきてしまい、結構やりこんでしまいます。とはいえ、冒頭にも述べたように新しいツールや表現方法を学べたりして、おもしろかったです。それから、地図を眺める時間が増えるため、少しだけ地理に詳しくなったりもしました。時間は結構必要ですが、挑戦する価値は非常に高いと思います。みなさんもぜひ挑戦してみてほしいと思います。

## 3. Rによる地図づくり

### 地図づくりの流れ

地図づくりは以下のような流れで進めました。最終的に作成した地図とコードはGitHubの「[NONONOexe/30DayMapChallenge](https://github.com/NONONOexe/30DayMapChallenge-2024)」で公開しています。

1. テーマに沿う地図をイメージ
2. イメージした地図を表現するためのデータを調査
3. 地図を作成（コーディング）
4. 作成した地図を調整
5. 地図を投稿
6. コードを整理してGitHubへコミット

表現方法がテーマになっているものが多いため、まずその表現でみせられるものを考えます。アイデアが浮かばないときはXでほかのひとが投稿している地図や過去の地図をみたり、利用できるデータから逆に考えたりしました。

データは30DayMapChallengeのサイトの「[Mapping resouces](https://30daymapchallenge.com/resources/)」から探すことができます。しかし、地理空間データは収集のコストもあるからか、思っているより少ないです。いろいろな国や組織から提供されてはいますが、多くは行政区域（州、県など）と紐づけられていることが多いです。

コーディングには、チャットボットも利用しています。私は主に次のツールを使っています：

* [@shohei05](https://twitter.com/shoei05)さんが公開しているGPTsの「[Rはいいぞ](https://chatgpt.com/g/g-8SyJH1UaN-rhaiiso)」
* Googleの「[Google AI Studio](https://aistudio.google.com)」

「Rはいいぞ」はRに特化したGPTsで送信した内容をRの内容として回答してくれます。「Google AI Studio」はGeminiをはじめさまざまなモデルが使えます。トークンに限りがあるのですが、その量が非常に多く、いまのところ私は使い切ったことがありません。チャットボットはそれぞれで回答内容が違うので、それぞれのいいところを活かして実装方法の模索やコードの整理などに利用しています。


### 使用したRパッケージ

使用したRパッケージを紹介します。Rには[Tidyverse](https://www.tidyverse.org/)というデータサイエンスのためのパッケージ群があります。これだけでもかなりさまざまなことができます。今回の地図づくりでは、Tidyverseに加えて、データを提供するパッケージや、地図づくりやWeb GISの機能を提供するパッケージを使用しました。

- dplyr
- tidyr
- forcats
- lubridate
- stringr

<!-- : データをTidyなものへ整理するためのパッケージです。縦持ち・横持ちの相互変換や、欠損値の処理などに利用します。 -->

<!-- : カテゴリカルなデータ（因子型）を操作するための提供するパッケージです。カテゴリのラベルの変更や順番の操作などに利用します。 -->

<!-- : 時間型のデータを操作するためのパッケージです。 -->

<!-- : さまざまな文字列操作関数を提供するパッケージです。 -->

#### データソースへのアクセス

eurostat
: [`{eurostat}`](https://ropengov.github.io/eurostat/index.html)はRから[ユーロスタット（EU統計局）](https://ec.europa.eu/eurostat)のオープンデータへアクセスするためのパッケージです。ユーロスタットはEU地域の統計データを提供しています。

jpndistrict
: [`{jpndistrict}`](https://uribo.github.io/jpndistrict/)は[国土数値情報](https://nlftp.mlit.go.jp/ksj/)で提供されている日本の行政区域を利用できるパッケージです。都道府県や市区町村別の塗分け地図を作りたいときなどに便利です。

marmap
:

rgbif
:

jmastats
:

elevatr
:

simplecensus

#### データの加工


sf
: Rでベクタ形式の地理空間データに関する機能（Simple Feature Access）を扱うためのパッケージです。PostGISなどと同じように`st_`からはじまるジオメトリ操作のためのさまざまな関数を提供します。また、`sf`というジオメトリを表現するデータ形式も提供しています。空間分析では欠かせないパッケージの一つです。

stars
:

raster
:

jsonlite
:

spatstat
:

gstat
:

#### 地図の描画

ggplot2
: グラフを作成するためのパッケージです。地理空間データについても後述する`sf`という形式のデータであれば、`geom_sf()`という関数でプロットできます。

osmdata
: Overpass APIによりOpenStreetMapのデータをRでダウンロードして扱うようにできるパッケージです。sfの形式でデータを扱えるため、地図づくりでは非常に便利です。

tmap
: 主題図を作成するためのパッケージです。sfやstarsのデータから地図を作成することができます。leafletでインタラクティブな地図を表示する`"view"`モードとggplot2でプロットとして地図を描画する`"plot"`モードがあるのも、とても便利でよく利用しています。

scales
:

showtext
:

sysfonts
:

arrow
:

rnaturalearth
:

tidycensus
:

units
:

rayshader
:

viridisLite
:

mapgl
:

geomtextpath
:

ggspatial
:

pavement
:

jpaccidents
:

magick
:



## 4. 作成した地図

| 日  | テーマ             | タイトル                    | ツール               |
| --: | ----------------  | -------------------------- | -------------------- |
|   1 | Points            | Shrine and Temple in Aichi | R, Affinity Designer |
|   2 | Lines             |
|   3 | Polygons          |
|   4 | Hexagons          |
|   5 | A journey         |
|   6 | Raster            |
|   7 | Vintage style     |
|   8 | Data: HDX         |
|   9 | AI only           |
|  10 | Pen & paper       |
|  11 | 

ユーロスタットでは、地域統計分類単位（NUTS）という単位で分けられたEUの地域に対してのデータが得られます。NUTSは0から3までのレベルがあり、レベル0だと国単位で、数字が上がるにつれて、地域が細かくなります。NUTS 3では、15万–80万人規模の地域に分けられています。

## x. まとめ

Rによる地図づくりはおもしろいため、作成したことのないひとはぜひこの記事をみて、試してもらいたいと思います。
この記事が、Rで地図づくりをするひとの助けや、来年以降の30DayMapChallengeでRを選択するひとが増えたらちょっとうれしいです。